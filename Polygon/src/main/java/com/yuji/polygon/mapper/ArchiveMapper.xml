<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dept.filesite.mapper.AnounceMapper">

    <resultMap id="BaseResultMap" type="com.yuji.polygon.entity.Archive">
        <id column="id" property="id"  />
        <result column="file_type" property="fileType" />
        <result column="issue_date" property="issueDate" />
        <result column="file_no" property="fileNo" />
        <result column="file_name" property="fileName"  />
        <result column="edit_office" property="editOffice"  />
        <result column="edit_person" property="editPerson"  />
        <result column="old_file_no" property="oldFileNo"  />
        <result column="note" property="note" />
        <result column="file_path" property="filePath" />
        <result column="is_new" property="newVersion"   />
    </resultMap>



    <insert id="insertArchive" parameterType="com.yuji.polygon.entity.Archive" useGeneratedKeys="true" keyProperty="id">
        insert into dept_anounce set file_type=#{fileType}, issue_date=#{issueDate}, file_no=#{fileNo}, file_name=#{fileName}
            , edit_office=#{editOffice}, edit_person=#{editPerson}, old_file_no=#{oldFileNo}, note=#{note}, file_path=#{filePath}, is_new=#{newVersion}
    </insert>


    <select id="countTotal" parameterType="java.util.Map" resultType="java.lang.Integer">
        select count(*) from dept_anounce
        <where>
            <if test="archive != null ">
                <if test="archive.fileNo != null and archive.fileNo != '' ">
                    file_no like CONCAT('%',#{archive.fileNo},'%')
                </if>
                <if test="archive.fileName != null and archive.fileName != '' ">
                    and file_name like CONCAT('%',#{archive.fileName},'%')
                </if>
                <if test="archive.editOffice != null and archive.editOffice != '' ">
                    and edit_office = #{archive.editOffice}
                </if>
                <if test="archive.editPerson != null and archive.editPerson != '' ">
                    and edit_person like CONCAT('%',#{archive.editPerson},'%')
                </if>
                <if test="archive.fileType != null and archive.fileType != '' ">
                    and file_type = #{archive.fileType}
                </if>
                <if test="archive.fileType == null or archive.fileType == '' ">
                    <if test="tab == 'manage'">
                        and file_type in ('管理规定','管理标准','技术标准','通知','体系规范')
                    </if>
                    <if test="tab == 'task'">
                        and file_type = '任务单'
                    </if>
                    <if test="tab == 'work'">
                        and file_type = '作业指导书'
                    </if>
                    <if test="tab == 'table'">
                        and file_type in ('综合类','管理类','专业类','模板')
                    </if>
                    <if test="tab == 'redtape'">
                        and file_type in ('红头文件','体系通报','表扬通报','质量黑榜'
                        ,'内部通报','职能通报','其他')
                    </if>
                    <if test="tab == 'train'">
                        and file_type = '培训资料'
                    </if>
                    <if test="tab == '分析报告'">
                        and file_type = '分析报告'
                    </if>

                </if>
                <if test="archive.issueDate != null and archive.issueDate != '' ">
                    and issue_date like CONCAT('%',#{archive.issueDate},'%')
                </if>
                <if test="archive.newVersion != null and archive.newVersion != '' ">
                    and is_new = #{archive.newVersion}
                </if>
            </if>


        </where>
    </select>

    

    <select id="listArchives" parameterType="java.util.Map"  resultMap="BaseResultMap">
        select * from dept_anounce
        <where>
            <if test="archive != null ">
                <if test="archive.fileNo != null and archive.fileNo != '' ">
                    and file_no like CONCAT('%',#{archive.fileNo},'%')
                </if>
                <if test="archive.fileName != null and archive.fileName != '' ">
                    and file_name like CONCAT('%',#{archive.fileName},'%')
                </if>
                <if test="archive.editOffice != null and archive.editOffice != '' ">
                    and edit_office = #{archive.editOffice}
                </if>
                <if test="archive.editPerson != null and archive.editPerson != '' ">
                    and edit_person like CONCAT('%',#{archive.editPerson},'%')
                </if>
                <if test="archive.fileType != null and archive.fileType != '' ">
                    and file_type = #{archive.fileType}
                </if>
                <if test="archive.fileType == null or archive.fileType == '' ">
                    <if test="tab == 'manage'">
                        and file_type in ('管理规定','管理标准','技术标准','通知','体系规范')
                    </if>
                    <if test="tab == 'task'">
                        and file_type = '任务单'
                    </if>
                    <if test="tab == 'work'">
                        and file_type = '作业指导书'
                    </if>
                    <if test="tab == 'table'">
                        and file_type in ('综合类','管理类','专业类','模板')
                    </if>
                    <if test="tab == 'redtape'">
                        and file_type in ('红头文件','体系通报','表扬通报','质量黑榜'
                        ,'内部通报','职能通报','其他')
                    </if>
                    <if test="tab == 'train'">
                        and file_type = '培训资料'
                    </if>
                    <if test="tab == 'analysis'">
                        and file_type = '分析报告'
                    </if>
                </if>
                <if test="archive.issueDate != null and archive.issueDate != '' ">
                    and issue_date like CONCAT('%',#{archive.issueDate},'%')
                </if>

                <if test="archive.newVersion != null and archive.newVersion != '' ">
                    and is_new = #{archive.newVersion}
                </if>

            </if>

        </where>
        order by issue_date desc limit #{startIndex},#{pageSize}
    </select>


    <update id="updateArchive" parameterType="com.yuji.polygon.entity.Archive" >
        update dept_anounce
        <set>
            <if test="fileType != null and fileType != '' ">
                file_type = #{fileType},
            </if>
            <if test="issueDate != null and issueDate != '' ">
                issue_date = #{issueDate},
            </if>
            <if test="fileNo != null and fileNo != '' ">
                file_no = #{fileNo},
            </if>
            <if test="fileName != null and fileName != '' ">
                file_name = #{fileName},
            </if>
            <if test="editOffice != null and editOffice != '' ">
                edit_office = #{editOffice},
            </if>
            <if test="editPerson != null and editPerson != '' ">
                edit_person = #{editPerson},
            </if>
            <if test="oldFileNo != null and oldFileNo != '' ">
                old_file_no = #{oldFileNo},
            </if>
            <if test="note != null and note != '' ">
                note = #{note},
            </if>
            <if test="filePath != null and filePath != '' ">
                file_path = #{filePath},
            </if>
            <if test="newVersion != null and newVersion != '' ">
                is_new = #{newVersion},
            </if>
            </set>
        where id = #{id}
    </update>

    <delete id="deleteArchiveById">
        delete from dept_anounce where id in 
        <foreach collection="aids" item="aid" open="(" close=")" separator=",">
            #{aid}
        </foreach>
    </delete>

    <select id="findArchiveById" resultMap="BaseResultMap">
        select * from dept_anounce where id = #{id}
    </select>
    
    <select id="findArchiveByFileNo" resultMap="BaseResultMap">
        select * from dept_anounce where file_no = #{fileNo}
    </select>
</mapper>